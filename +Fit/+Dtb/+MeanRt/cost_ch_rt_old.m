function [cost,grad,hess] = cost_ch_rt(b,coh,coh0,k,n_ch2,n_tot,rt_obs,rt_sem_obs,tnd)
%COST_CH_RT
%    [COST,GRAD,HESS] = COST_CH_RT(B,COH,COH0,K,N_CH2,N_TOT,RT_OBS,RT_SEM_OBS,TND)

%    This function was generated by the Symbolic Math Toolbox version 6.3.
%    08-Aug-2016 11:48:04

cost = gammaln(-n_ch2+n_tot+1.0)+gammaln(n_ch2+1.0)-gammaln(n_tot+1.0)+log(rt_sem_obs)-n_ch2.*log(1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0))+1.0./rt_sem_obs.^2.*(-rt_obs+tnd+(b.*tanh(b.*k.*(coh-coh0)))./(k.*(coh-coh0))).^2.*(1.0./2.0)+log(-1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0)+1.0).*(n_ch2-n_tot);
if nargout > 1
    grad = [
        -1.0./rt_sem_obs.^2.*(b.*(tanh(b.*k.*(coh-coh0)).^2-1.0)-tanh(b.*k.*(coh-coh0))./(k.*(coh-coh0))).*(-rt_obs+tnd+(b.*tanh(b.*k.*(coh-coh0)))./(k.*(coh-coh0)))-(k.*n_ch2.*exp(b.*k.*(coh-coh0).*-2.0).*(coh-coh0).*2.0)./(exp(b.*k.*(coh-coh0).*-2.0)+1.0)+(k.*exp(b.*k.*(coh-coh0).*-2.0).*1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0).^2.*(coh-coh0).*(n_ch2-n_tot).*2.0)./(1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0)-1.0)
        -1.0./rt_sem_obs.^2.*((b.^2.*(tanh(b.*k.*(coh-coh0)).^2-1.0))./k+(b.*1.0./k.^2.*tanh(b.*k.*(coh-coh0)))./(coh-coh0)).*(-rt_obs+tnd+(b.*tanh(b.*k.*(coh-coh0)))./(k.*(coh-coh0)))-(b.*n_ch2.*exp(b.*k.*(coh-coh0).*-2.0).*(coh-coh0).*2.0)./(exp(b.*k.*(coh-coh0).*-2.0)+1.0)+(b.*exp(b.*k.*(coh-coh0).*-2.0).*1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0).^2.*(coh-coh0).*(n_ch2-n_tot).*2.0)./(1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0)-1.0)
        1.0./rt_sem_obs.^2.*((b.^2.*(tanh(b.*k.*(coh-coh0)).^2-1.0))./(coh-coh0)+(b.*tanh(b.*k.*(coh-coh0)).*1.0./(coh-coh0).^2)./k).*(-rt_obs+tnd+(b.*tanh(b.*k.*(coh-coh0)))./(k.*(coh-coh0)))+(b.*k.*n_ch2.*exp(b.*k.*(coh-coh0).*-2.0).*2.0)./(exp(b.*k.*(coh-coh0).*-2.0)+1.0)-(b.*k.*exp(b.*k.*(coh-coh0).*-2.0).*1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0).^2.*(n_ch2-n_tot).*2.0)./(1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0)-1.0)
        1.0./rt_sem_obs.^2.*(rt_obs.*-2.0+tnd.*2.0+(b.*tanh(b.*k.*(coh-coh0)).*2.0)./(k.*(coh-coh0))).*(1.0./2.0)
        ]';
    
    grad = min(max(grad, -1e10), 1e10); %#ok<UDIM>
end
if nargout > 2
    hess = reshape([1.0./rt_sem_obs.^2.*(b.*(tanh(b.*k.*(coh-coh0)).^2-1.0)-tanh(b.*k.*(coh-coh0))./(k.*(coh-coh0))).^2+1.0./rt_sem_obs.^2.*(tanh(b.*k.*(coh-coh0)).^2.*-2.0+b.*k.*tanh(b.*k.*(coh-coh0)).*(coh-coh0).*(tanh(b.*k.*(coh-coh0)).^2-1.0).*2.0+2.0).*(-rt_obs+tnd+(b.*tanh(b.*k.*(coh-coh0)))./(k.*(coh-coh0)))+(k.^2.*n_ch2.*exp(b.*k.*(coh-coh0).*-2.0).*(coh-coh0).^2.*4.0)./(exp(b.*k.*(coh-coh0).*-2.0)+1.0)-k.^2.*n_ch2.*exp(b.*k.*(coh-coh0).*-4.0).*1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0).^2.*(coh-coh0).^2.*4.0-(k.^2.*exp(b.*k.*(coh-coh0).*-2.0).*1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0).^2.*(coh-coh0).^2.*(n_ch2-n_tot).*4.0)./(1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0)-1.0)+(k.^2.*exp(b.*k.*(coh-coh0).*-4.0).*1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0).^3.*(coh-coh0).^2.*(n_ch2-n_tot).*8.0)./(1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0)-1.0)-k.^2.*exp(b.*k.*(coh-coh0).*-4.0).*1.0./(1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0)-1.0).^2.*1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0).^4.*(coh-coh0).^2.*(n_ch2-n_tot).*4.0,-1.0./rt_sem_obs.^2.*(-rt_obs+tnd+(b.*tanh(b.*k.*(coh-coh0)))./(k.*(coh-coh0))).*((1.0./k.^2.*tanh(b.*k.*(coh-coh0)))./(coh-coh0)+(b.*(tanh(b.*k.*(coh-coh0)).^2-1.0))./k-b.^2.*tanh(b.*k.*(coh-coh0)).*(coh-coh0).*(tanh(b.*k.*(coh-coh0)).^2-1.0).*2.0)+1.0./rt_sem_obs.^2.*(b.*(tanh(b.*k.*(coh-coh0)).^2-1.0)-tanh(b.*k.*(coh-coh0))./(k.*(coh-coh0))).*((b.^2.*(tanh(b.*k.*(coh-coh0)).^2-1.0))./k+(b.*1.0./k.^2.*tanh(b.*k.*(coh-coh0)))./(coh-coh0))-(n_ch2.*exp(b.*k.*(coh-coh0).*-2.0).*(coh-coh0).*2.0)./(exp(b.*k.*(coh-coh0).*-2.0)+1.0)+(exp(b.*k.*(coh-coh0).*-2.0).*1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0).^2.*(coh-coh0).*(n_ch2-n_tot).*2.0)./(1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0)-1.0)+(b.*k.*n_ch2.*exp(b.*k.*(coh-coh0).*-2.0).*(coh-coh0).^2.*4.0)./(exp(b.*k.*(coh-coh0).*-2.0)+1.0)-b.*k.*n_ch2.*exp(b.*k.*(coh-coh0).*-4.0).*1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0).^2.*(coh-coh0).^2.*4.0-(b.*k.*exp(b.*k.*(coh-coh0).*-2.0).*1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0).^2.*(coh-coh0).^2.*(n_ch2-n_tot).*4.0)./(1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0)-1.0)+(b.*k.*exp(b.*k.*(coh-coh0).*-4.0).*1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0).^3.*(coh-coh0).^2.*(n_ch2-n_tot).*8.0)./(1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0)-1.0)-b.*k.*exp(b.*k.*(coh-coh0).*-4.0).*1.0./(1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0)-1.0).^2.*1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0).^4.*(coh-coh0).^2.*(n_ch2-n_tot).*4.0,1.0./rt_sem_obs.^2.*(-rt_obs+tnd+(b.*tanh(b.*k.*(coh-coh0)))./(k.*(coh-coh0))).*((tanh(b.*k.*(coh-coh0)).*1.0./(coh-coh0).^2)./k+(b.*(tanh(b.*k.*(coh-coh0)).^2-1.0))./(coh-coh0)-b.^2.*k.*tanh(b.*k.*(coh-coh0)).*(tanh(b.*k.*(coh-coh0)).^2-1.0).*2.0)-1.0./rt_sem_obs.^2.*(b.*(tanh(b.*k.*(coh-coh0)).^2-1.0)-tanh(b.*k.*(coh-coh0))./(k.*(coh-coh0))).*((b.^2.*(tanh(b.*k.*(coh-coh0)).^2-1.0))./(coh-coh0)+(b.*tanh(b.*k.*(coh-coh0)).*1.0./(coh-coh0).^2)./k)+(k.*n_ch2.*exp(b.*k.*(coh-coh0).*-2.0).*2.0)./(exp(b.*k.*(coh-coh0).*-2.0)+1.0)-(k.*exp(b.*k.*(coh-coh0).*-2.0).*1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0).^2.*(n_ch2-n_tot).*2.0)./(1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0)-1.0)-(b.*k.^2.*n_ch2.*exp(b.*k.*(coh-coh0).*-2.0).*(coh-coh0).*4.0)./(exp(b.*k.*(coh-coh0).*-2.0)+1.0)+b.*k.^2.*n_ch2.*exp(b.*k.*(coh-coh0).*-4.0).*1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0).^2.*(coh-coh0).*4.0+(b.*k.^2.*exp(b.*k.*(coh-coh0).*-2.0).*1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0).^2.*(coh-coh0).*(n_ch2-n_tot).*4.0)./(1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0)-1.0)-(b.*k.^2.*exp(b.*k.*(coh-coh0).*-4.0).*1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0).^3.*(coh-coh0).*(n_ch2-n_tot).*8.0)./(1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0)-1.0)+b.*k.^2.*exp(b.*k.*(coh-coh0).*-4.0).*1.0./(1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0)-1.0).^2.*1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0).^4.*(coh-coh0).*(n_ch2-n_tot).*4.0,-1.0./rt_sem_obs.^2.*(b.*(tanh(b.*k.*(coh-coh0)).^2-1.0)-tanh(b.*k.*(coh-coh0))./(k.*(coh-coh0))),-1.0./rt_sem_obs.^2.*(-rt_obs+tnd+(b.*tanh(b.*k.*(coh-coh0)))./(k.*(coh-coh0))).*((1.0./k.^2.*tanh(b.*k.*(coh-coh0)))./(coh-coh0)+(b.*(tanh(b.*k.*(coh-coh0)).^2-1.0))./k-b.^2.*tanh(b.*k.*(coh-coh0)).*(coh-coh0).*(tanh(b.*k.*(coh-coh0)).^2-1.0).*2.0)+1.0./rt_sem_obs.^2.*(b.*(tanh(b.*k.*(coh-coh0)).^2-1.0)-tanh(b.*k.*(coh-coh0))./(k.*(coh-coh0))).*((b.^2.*(tanh(b.*k.*(coh-coh0)).^2-1.0))./k+(b.*1.0./k.^2.*tanh(b.*k.*(coh-coh0)))./(coh-coh0))-(n_ch2.*exp(b.*k.*(coh-coh0).*-2.0).*(coh-coh0).*2.0)./(exp(b.*k.*(coh-coh0).*-2.0)+1.0)+(exp(b.*k.*(coh-coh0).*-2.0).*1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0).^2.*(coh-coh0).*(n_ch2-n_tot).*2.0)./(1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0)-1.0)+(b.*k.*n_ch2.*exp(b.*k.*(coh-coh0).*-2.0).*(coh-coh0).^2.*4.0)./(exp(b.*k.*(coh-coh0).*-2.0)+1.0)-b.*k.*n_ch2.*exp(b.*k.*(coh-coh0).*-4.0).*1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0).^2.*(coh-coh0).^2.*4.0-(b.*k.*exp(b.*k.*(coh-coh0).*-2.0).*1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0).^2.*(coh-coh0).^2.*(n_ch2-n_tot).*4.0)./(1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0)-1.0)+(b.*k.*exp(b.*k.*(coh-coh0).*-4.0).*1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0).^3.*(coh-coh0).^2.*(n_ch2-n_tot).*8.0)./(1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0)-1.0)-b.*k.*exp(b.*k.*(coh-coh0).*-4.0).*1.0./(1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0)-1.0).^2.*1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0).^4.*(coh-coh0).^2.*(n_ch2-n_tot).*4.0,1.0./rt_sem_obs.^2.*((b.^2.*(tanh(b.*k.*(coh-coh0)).^2-1.0))./k+(b.*1.0./k.^2.*tanh(b.*k.*(coh-coh0)))./(coh-coh0)).^2+1.0./rt_sem_obs.^2.*(-rt_obs+tnd+(b.*tanh(b.*k.*(coh-coh0)))./(k.*(coh-coh0))).*(b.^2.*1.0./k.^2.*(tanh(b.*k.*(coh-coh0)).^2-1.0).*2.0+(b.*1.0./k.^3.*tanh(b.*k.*(coh-coh0)).*2.0)./(coh-coh0)+(b.^3.*tanh(b.*k.*(coh-coh0)).*(coh-coh0).*(tanh(b.*k.*(coh-coh0)).^2-1.0).*2.0)./k)+(b.^2.*n_ch2.*exp(b.*k.*(coh-coh0).*-2.0).*(coh-coh0).^2.*4.0)./(exp(b.*k.*(coh-coh0).*-2.0)+1.0)-b.^2.*n_ch2.*exp(b.*k.*(coh-coh0).*-4.0).*1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0).^2.*(coh-coh0).^2.*4.0-(b.^2.*exp(b.*k.*(coh-coh0).*-2.0).*1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0).^2.*(coh-coh0).^2.*(n_ch2-n_tot).*4.0)./(1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0)-1.0)+(b.^2.*exp(b.*k.*(coh-coh0).*-4.0).*1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0).^3.*(coh-coh0).^2.*(n_ch2-n_tot).*8.0)./(1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0)-1.0)-b.^2.*exp(b.*k.*(coh-coh0).*-4.0).*1.0./(1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0)-1.0).^2.*1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0).^4.*(coh-coh0).^2.*(n_ch2-n_tot).*4.0,-1.0./rt_sem_obs.^2.*(-rt_obs+tnd+(b.*tanh(b.*k.*(coh-coh0)))./(k.*(coh-coh0))).*(b.^3.*tanh(b.*k.*(coh-coh0)).*(tanh(b.*k.*(coh-coh0)).^2-1.0).*2.0+b.*1.0./k.^2.*tanh(b.*k.*(coh-coh0)).*1.0./(coh-coh0).^2+(b.^2.*(tanh(b.*k.*(coh-coh0)).^2-1.0))./(k.*(coh-coh0)))-1.0./rt_sem_obs.^2.*((b.^2.*(tanh(b.*k.*(coh-coh0)).^2-1.0))./k+(b.*1.0./k.^2.*tanh(b.*k.*(coh-coh0)))./(coh-coh0)).*((b.^2.*(tanh(b.*k.*(coh-coh0)).^2-1.0))./(coh-coh0)+(b.*tanh(b.*k.*(coh-coh0)).*1.0./(coh-coh0).^2)./k)+(b.*n_ch2.*exp(b.*k.*(coh-coh0).*-2.0).*2.0)./(exp(b.*k.*(coh-coh0).*-2.0)+1.0)-(b.*exp(b.*k.*(coh-coh0).*-2.0).*1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0).^2.*(n_ch2-n_tot).*2.0)./(1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0)-1.0)-(b.^2.*k.*n_ch2.*exp(b.*k.*(coh-coh0).*-2.0).*(coh-coh0).*4.0)./(exp(b.*k.*(coh-coh0).*-2.0)+1.0)+b.^2.*k.*n_ch2.*exp(b.*k.*(coh-coh0).*-4.0).*1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0).^2.*(coh-coh0).*4.0+(b.^2.*k.*exp(b.*k.*(coh-coh0).*-2.0).*1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0).^2.*(coh-coh0).*(n_ch2-n_tot).*4.0)./(1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0)-1.0)-(b.^2.*k.*exp(b.*k.*(coh-coh0).*-4.0).*1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0).^3.*(coh-coh0).*(n_ch2-n_tot).*8.0)./(1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0)-1.0)+b.^2.*k.*exp(b.*k.*(coh-coh0).*-4.0).*1.0./(1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0)-1.0).^2.*1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0).^4.*(coh-coh0).*(n_ch2-n_tot).*4.0,-1.0./rt_sem_obs.^2.*((b.^2.*(tanh(b.*k.*(coh-coh0)).^2-1.0))./k+(b.*1.0./k.^2.*tanh(b.*k.*(coh-coh0)))./(coh-coh0)),1.0./rt_sem_obs.^2.*(-rt_obs+tnd+(b.*tanh(b.*k.*(coh-coh0)))./(k.*(coh-coh0))).*((tanh(b.*k.*(coh-coh0)).*1.0./(coh-coh0).^2)./k+(b.*(tanh(b.*k.*(coh-coh0)).^2-1.0))./(coh-coh0)-b.^2.*k.*tanh(b.*k.*(coh-coh0)).*(tanh(b.*k.*(coh-coh0)).^2-1.0).*2.0)-1.0./rt_sem_obs.^2.*(b.*(tanh(b.*k.*(coh-coh0)).^2-1.0)-tanh(b.*k.*(coh-coh0))./(k.*(coh-coh0))).*((b.^2.*(tanh(b.*k.*(coh-coh0)).^2-1.0))./(coh-coh0)+(b.*tanh(b.*k.*(coh-coh0)).*1.0./(coh-coh0).^2)./k)+(k.*n_ch2.*exp(b.*k.*(coh-coh0).*-2.0).*2.0)./(exp(b.*k.*(coh-coh0).*-2.0)+1.0)-(k.*exp(b.*k.*(coh-coh0).*-2.0).*1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0).^2.*(n_ch2-n_tot).*2.0)./(1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0)-1.0)-(b.*k.^2.*n_ch2.*exp(b.*k.*(coh-coh0).*-2.0).*(coh-coh0).*4.0)./(exp(b.*k.*(coh-coh0).*-2.0)+1.0)+b.*k.^2.*n_ch2.*exp(b.*k.*(coh-coh0).*-4.0).*1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0).^2.*(coh-coh0).*4.0+(b.*k.^2.*exp(b.*k.*(coh-coh0).*-2.0).*1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0).^2.*(coh-coh0).*(n_ch2-n_tot).*4.0)./(1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0)-1.0)-(b.*k.^2.*exp(b.*k.*(coh-coh0).*-4.0).*1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0).^3.*(coh-coh0).*(n_ch2-n_tot).*8.0)./(1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0)-1.0)+b.*k.^2.*exp(b.*k.*(coh-coh0).*-4.0).*1.0./(1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0)-1.0).^2.*1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0).^4.*(coh-coh0).*(n_ch2-n_tot).*4.0,-1.0./rt_sem_obs.^2.*(-rt_obs+tnd+(b.*tanh(b.*k.*(coh-coh0)))./(k.*(coh-coh0))).*(b.^3.*tanh(b.*k.*(coh-coh0)).*(tanh(b.*k.*(coh-coh0)).^2-1.0).*2.0+b.*1.0./k.^2.*tanh(b.*k.*(coh-coh0)).*1.0./(coh-coh0).^2+(b.^2.*(tanh(b.*k.*(coh-coh0)).^2-1.0))./(k.*(coh-coh0)))-1.0./rt_sem_obs.^2.*((b.^2.*(tanh(b.*k.*(coh-coh0)).^2-1.0))./k+(b.*1.0./k.^2.*tanh(b.*k.*(coh-coh0)))./(coh-coh0)).*((b.^2.*(tanh(b.*k.*(coh-coh0)).^2-1.0))./(coh-coh0)+(b.*tanh(b.*k.*(coh-coh0)).*1.0./(coh-coh0).^2)./k)+(b.*n_ch2.*exp(b.*k.*(coh-coh0).*-2.0).*2.0)./(exp(b.*k.*(coh-coh0).*-2.0)+1.0)-(b.*exp(b.*k.*(coh-coh0).*-2.0).*1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0).^2.*(n_ch2-n_tot).*2.0)./(1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0)-1.0)-(b.^2.*k.*n_ch2.*exp(b.*k.*(coh-coh0).*-2.0).*(coh-coh0).*4.0)./(exp(b.*k.*(coh-coh0).*-2.0)+1.0)+b.^2.*k.*n_ch2.*exp(b.*k.*(coh-coh0).*-4.0).*1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0).^2.*(coh-coh0).*4.0+(b.^2.*k.*exp(b.*k.*(coh-coh0).*-2.0).*1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0).^2.*(coh-coh0).*(n_ch2-n_tot).*4.0)./(1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0)-1.0)-(b.^2.*k.*exp(b.*k.*(coh-coh0).*-4.0).*1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0).^3.*(coh-coh0).*(n_ch2-n_tot).*8.0)./(1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0)-1.0)+b.^2.*k.*exp(b.*k.*(coh-coh0).*-4.0).*1.0./(1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0)-1.0).^2.*1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0).^4.*(coh-coh0).*(n_ch2-n_tot).*4.0,1.0./rt_sem_obs.^2.*((b.^2.*(tanh(b.*k.*(coh-coh0)).^2-1.0))./(coh-coh0)+(b.*tanh(b.*k.*(coh-coh0)).*1.0./(coh-coh0).^2)./k).^2+1.0./rt_sem_obs.^2.*(-rt_obs+tnd+(b.*tanh(b.*k.*(coh-coh0)))./(k.*(coh-coh0))).*(b.^2.*1.0./(coh-coh0).^2.*(tanh(b.*k.*(coh-coh0)).^2-1.0).*2.0+(b.*tanh(b.*k.*(coh-coh0)).*1.0./(coh-coh0).^3.*2.0)./k+(b.^3.*k.*tanh(b.*k.*(coh-coh0)).*(tanh(b.*k.*(coh-coh0)).^2-1.0).*2.0)./(coh-coh0))+(b.^2.*k.^2.*n_ch2.*exp(b.*k.*(coh-coh0).*-2.0).*4.0)./(exp(b.*k.*(coh-coh0).*-2.0)+1.0)-b.^2.*k.^2.*n_ch2.*exp(b.*k.*(coh-coh0).*-4.0).*1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0).^2.*4.0-(b.^2.*k.^2.*exp(b.*k.*(coh-coh0).*-2.0).*1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0).^2.*(n_ch2-n_tot).*4.0)./(1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0)-1.0)+(b.^2.*k.^2.*exp(b.*k.*(coh-coh0).*-4.0).*1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0).^3.*(n_ch2-n_tot).*8.0)./(1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0)-1.0)-b.^2.*k.^2.*exp(b.*k.*(coh-coh0).*-4.0).*1.0./(1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0)-1.0).^2.*1.0./(exp(b.*k.*(coh-coh0).*-2.0)+1.0).^4.*(n_ch2-n_tot).*4.0,1.0./rt_sem_obs.^2.*((b.^2.*(tanh(b.*k.*(coh-coh0)).^2-1.0))./(coh-coh0)+(b.*tanh(b.*k.*(coh-coh0)).*1.0./(coh-coh0).^2)./k),-1.0./rt_sem_obs.^2.*(b.*(tanh(b.*k.*(coh-coh0)).^2-1.0)-tanh(b.*k.*(coh-coh0))./(k.*(coh-coh0))),-1.0./rt_sem_obs.^2.*((b.^2.*(tanh(b.*k.*(coh-coh0)).^2-1.0))./k+(b.*1.0./k.^2.*tanh(b.*k.*(coh-coh0)))./(coh-coh0)),1.0./rt_sem_obs.^2.*((b.^2.*(tanh(b.*k.*(coh-coh0)).^2-1.0))./(coh-coh0)+(b.*tanh(b.*k.*(coh-coh0)).*1.0./(coh-coh0).^2)./k),1.0./rt_sem_obs.^2],[4,4]);
    hess = min(max(hess, -1e10), 1e10);
end
